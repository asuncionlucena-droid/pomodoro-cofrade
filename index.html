<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pomodoro Estudio</title>

<style>
body{margin:0;background:#000;color:#fff;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;}
.wrap{max-width:700px;margin:auto;padding:30px;}
.time{font-size:80px;text-align:center;margin:20px 0;}
button{background:#111;color:#fff;border:1px solid #444;padding:14px;border-radius:12px;margin:6px;font-size:16px;cursor:pointer;}
input{background:#000;border:1px solid #333;color:#fff;padding:10px;border-radius:8px;width:100%;}
.card{background:#0b0b0b;border:1px solid #222;border-radius:18px;padding:20px;margin-bottom:20px;}
</style>
</head>

<body>
<div class="wrap">

<div class="card">
<h2>Pomodoro Estudio</h2>

<div class="time" id="time">30:00</div>

<button onclick="start()">Empezar</button>
<button onclick="pause()">Pausar</button>
<button onclick="reset()">Reiniciar</button>

<div style="margin-top:20px">
Foco (min): <input id="focusMin" type="number" value="30">
Descanso (min): <input id="breakMin" type="number" value="5">
</div>

<div style="margin-top:20px">
Spotify:
<input id="spotify" placeholder="pega enlace">
<button onclick="openSpotify()">Abrir Spotify</button>
</div>

</div>

<div class="card" id="decision" style="display:none">
<h3>Bloque terminado</h3>
<button onclick="descanso()">Descansar</button>
<button onclick="seguir()">Seguir estudiando</button>
</div>

</div>

<script>

let mode="focus"
let running=false
let endTime=0
let interval=null

function format(ms){
let total=Math.ceil(ms/1000)
let m=Math.floor(total/60)
let s=total%60
return m+":"+String(s).padStart(2,"0")
}

function sonido(){
let ctx=new AudioContext()
let osc=ctx.createOscillator()
osc.connect(ctx.destination)
osc.frequency.value=500
osc.start()
setTimeout(()=>osc.stop(),300)
}

function tick(){
let remaining=endTime-Date.now()
if(remaining<=0){
clearInterval(interval)
running=false
sonido()
document.getElementById("decision").style.display="block"
return
}
document.getElementById("time").innerText=format(remaining)
}

function start(){
if(running)return
running=true
let minutes=mode=="focus"?document.getElementById("focusMin").value:document.getElementById("breakMin").value
endTime=Date.now()+minutes*60000
interval=setInterval(tick,1000)
}

function pause(){
running=false
clearInterval(interval)
}

function reset(){
pause()
mode="focus"
document.getElementById("time").innerText="30:00"
}

function descanso(){
mode="break"
document.getElementById("decision").style.display="none"
start()
}

function seguir(){
mode="focus"
document.getElementById("decision").style.display="none"
start()
}

function openSpotify(){
let url=document.getElementById("spotify").value
localStorage.setItem("spotify",url)
window.open(url)
}

document.getElementById("spotify").value=localStorage.getItem("spotify")||""

</script>

</body>
</html>
