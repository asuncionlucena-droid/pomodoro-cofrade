<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Pomodoro Ignacio</title>

<style>
body{
  margin:0;
  background:#0b0b0b;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
}
.wrap{max-width:900px;margin:auto;padding:24px}
.card{background:#121212;border:1px solid #2a2a2a;border-radius:18px;padding:20px;margin-bottom:18px}
.time{font-size:80px;text-align:center;margin:10px 0}
button{background:#1a1a1a;color:#fff;border:1px solid #444;padding:12px;border-radius:12px;margin:6px;cursor:pointer}
input{background:#0f0f0f;border:1px solid #333;color:#fff;padding:10px;border-radius:8px;width:100%}
.tag{padding:6px 12px;border-radius:999px;font-size:12px;display:inline-block;margin-bottom:8px}
.tagFocus{background:#331111;border:1px solid #883333}
.tagBreak{background:#113322;border:1px solid #338855}
.holycard{
  background:#fff;
  color:#000;
  border-radius:12px;
  padding:12px;
  margin:8px 0;
  box-shadow:0 6px 20px rgba(0,0,0,0.4);
}
.toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#111;
  padding:14px 20px;
  border-radius:12px;
  border:1px solid #444;
  display:none;
}
.toast.show{display:block}
</style>
</head>

<body>

<div class="wrap">

<div class="card">
<div id="modeTag" class="tag tagFocus">FOCO</div>
<div class="time" id="time">30:00</div>

<div style="text-align:center">
<button id="btnStart">Empezar</button>
<button id="btnPause">Pausar</button>
<button id="btnReset">Reiniciar</button>
<button id="btnSpotify">Spotify</button>
</div>

<br>

Foco (min):
<input id="focusMin" type="number" value="30">

Descanso (min):
<input id="breakMin" type="number" value="5">

Enlace Spotify:
<input id="spotifyUrl" placeholder="pega tu playlist">

</div>

<div class="card">
Tramos: <span id="tramos">0</span><br>
Faltan para Domingo de Ramos: <span id="ramosLeft">0</span> días
</div>

<div class="card">
<div id="prompt" style="display:none">
¿Descansar o seguir?
<br>
<button id="btnBreak">Descansar</button>
<button id="btnContinue">Seguir</button>
</div>
</div>

<div class="card">
Recompensas:
<div id="recompensas"></div>
</div>

</div>

<div id="toast" class="toast"></div>

<script>
const $=(id)=>document.getElementById(id)

const LS={
focusMin:"pc2_focusMin",
breakMin:"pc2_breakMin",
spotify:"pc2_spotify",
tramos:"pc2_tramos",
herms:"pc2_herms"
}

const RAMOS_DATE=new Date("2026-03-29")

const hermandades=[
"Macarena","Triana","Gran Poder","San Benito","La Estrella","Los Gitanos",
"El Cerro","San Bernardo","La Sed","San Gonzalo","Redención","San Pablo"
]

let state={
mode:"focus",
running:false,
durationMs:30*60*1000,
endTs:null,
rafId:null
}

let audioCtx=null

function armAudio(){
if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)()
if(audioCtx.state==="suspended")audioCtx.resume()
}

function beep(){
try{
if(!audioCtx)return
const now=audioCtx.currentTime
const o=audioCtx.createOscillator()
const g=audioCtx.createGain()
o.frequency.value=880
g.gain.setValueAtTime(0.001,now)
g.gain.exponentialRampToValueAtTime(0.15,now+0.02)
g.gain.exponentialRampToValueAtTime(0.001,now+0.3)
o.connect(g);g.connect(audioCtx.destination)
o.start(now)
o.stop(now+0.3)
}catch(e){}
}

function fmt(ms){
ms=Math.max(0,ms)
const t=Math.floor(ms/1000)
return String(Math.floor(t/60)).padStart(2,"0")+":"+String(t%60).padStart(2,"0")
}

function daysToRamos(){
const diff=RAMOS_DATE-new Date()
return Math.ceil(diff/(24*60*60*1000))
}

function load(){
$("focusMin").value=localStorage.getItem(LS.focusMin)||30
$("breakMin").value=localStorage.getItem(LS.breakMin)||5
$("spotifyUrl").value=localStorage.getItem(LS.spotify)||""
$("tramos").textContent=localStorage.getItem(LS.tramos)||0
$("ramosLeft").textContent=daysToRamos()
}

function save(){
localStorage.setItem(LS.focusMin,$("focusMin").value)
localStorage.setItem(LS.breakMin,$("breakMin").value)
localStorage.setItem(LS.spotify,$("spotifyUrl").value)
}

function start(){
armAudio()
save()

const min=state.mode==="focus"?$("focusMin").value:$("breakMin").value
state.durationMs=min*60*1000
state.endTs=performance.now()+state.durationMs
state.running=true
tick()
}

function pause(){
state.running=false
cancelAnimationFrame(state.rafId)
}

function reset(){
pause()
$("time").textContent=fmt(state.durationMs)
}

function tick(){
if(!state.running)return
const remaining=state.endTs-performance.now()
$("time").textContent=fmt(remaining)
if(remaining<=0){finish();return}
state.rafId=requestAnimationFrame(tick)
}

function finish(){
state.running=false
beep()

if(state.mode==="focus"){
let tr=parseInt(localStorage.getItem(LS.tramos)||0)+1
localStorage.setItem(LS.tramos,tr)
$("tramos").textContent=tr
$("prompt").style.display="block"
}else{
state.mode="focus"
}
}

function breakStart(){
state.mode="break"
$("modeTag").className="tag tagBreak"
$("modeTag").textContent="DESCANSO"
$("prompt").style.display="none"
start()
}

function continueStart(){
state.mode="focus"
$("modeTag").className="tag tagFocus"
$("modeTag").textContent="FOCO"
$("prompt").style.display="none"
start()
}

$("btnStart").onclick=start
$("btnPause").onclick=pause
$("btnReset").onclick=reset
$("btnBreak").onclick=breakStart
$("btnContinue").onclick=continueStart
$("btnSpotify").onclick=()=>window.open($("spotifyUrl").value)

load()
</script>

</body>
</html>
